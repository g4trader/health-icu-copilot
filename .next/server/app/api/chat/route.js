"use strict";(()=>{var e={};e.id=744,e.ids=[744],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},4215:(e,a,i)=>{i.r(a),i.d(a,{originalPathname:()=>b,patchFetch:()=>w,requestAsyncStorage:()=>$,routeModule:()=>P,serverHooks:()=>I,staticGenerationAsyncStorage:()=>v});var o={};i.r(o),i.d(o,{POST:()=>x});var s=i(9303),n=i(8716),t=i(670),r=i(7070),c=i(6666);async function l(e){let a=process.env.GROQ_API_KEY;if(!a)return e.draftText;try{let i=await fetch("https://api.groq.com/openai/v1/chat/completions",{method:"POST",headers:{Authorization:`Bearer ${a}`,"Content-Type":"application/json"},body:JSON.stringify({model:"llama-3.1-70b-versatile",messages:[{role:"system",content:e.systemPrompt},{role:"user",content:`Contexto cl\xednico:
${e.context}

Texto a melhorar (mantenha todos os fatos e n\xfameros exatamente como est\xe3o):
${e.draftText}

Melhore a reda\xe7\xe3o deste texto mantendo todos os fatos, n\xfameros e dados cl\xednicos exatamente como est\xe3o. Use linguagem m\xe9dica apropriada e tom assistivo.`}],temperature:.3,max_tokens:2e3})});if(!i.ok)return console.warn("Groq API error, returning original text"),e.draftText;let o=await i.json(),s=o.choices?.[0]?.message?.content;if(!s)return e.draftText;return s}catch(a){return console.warn("Error calling Groq API:",a),e.draftText}}let d=[],u=new Map;function p(e){return u.has(e)||u.set(e,{sessionId:e,pacienteAtivo:null,historicoIntencoes:[]}),u.get(e)}let m={default:{type:"default",name:"Assistente Geral",systemPrompt:"Voc\xea \xe9 um assistente m\xe9dico para UTI pedi\xe1trica. Melhore a reda\xe7\xe3o de textos mantendo todos os fatos e n\xfameros exatamente como est\xe3o. Use linguagem m\xe9dica apropriada e tom assistivo, evitando linguagem prescritiva.",keywords:[]},cardiology:{type:"cardiology",name:"Especialista em Cardiologia Pedi\xe1trica",systemPrompt:"Voc\xea \xe9 um assistente m\xe9dico especializado em cardiologia pedi\xe1trica para UTI. Melhore a reda\xe7\xe3o de textos mantendo todos os fatos e n\xfameros exatamente como est\xe3o. Use linguagem m\xe9dica apropriada com foco em aspectos cardiovasculares, hemodin\xe2micos e fun\xe7\xe3o card\xedaca. Tom assistivo, evitando linguagem prescritiva.",keywords:["cardio","cardio:","cardiologia","card\xedaco","cardiaco","hemodin\xe2mica","hemodinamica","vasopressor","fun\xe7\xe3o card\xedaca","funcao cardiaca"]},pneumology:{type:"pneumology",name:"Especialista em Pneumologia Pedi\xe1trica",systemPrompt:"Voc\xea \xe9 um assistente m\xe9dico especializado em pneumologia pedi\xe1trica para UTI. Melhore a reda\xe7\xe3o de textos mantendo todos os fatos e n\xfameros exatamente como est\xe3o. Use linguagem m\xe9dica apropriada com foco em aspectos respirat\xf3rios, ventila\xe7\xe3o mec\xe2nica e fun\xe7\xe3o pulmonar. Tom assistivo, evitando linguagem prescritiva.",keywords:["pneumo","pneumo:","pneumologia","respirat\xf3rio","respiratorio","ventila\xe7\xe3o","ventilacao","vm","pao2","fio2"]},neurology:{type:"neurology",name:"Especialista em Neurologia Pedi\xe1trica",systemPrompt:"Voc\xea \xe9 um assistente m\xe9dico especializado em neurologia pedi\xe1trica para UTI. Melhore a reda\xe7\xe3o de textos mantendo todos os fatos e n\xfameros exatamente como est\xe3o. Use linguagem m\xe9dica apropriada com foco em aspectos neurol\xf3gicos, escala de Glasgow, press\xe3o intracraniana e fun\xe7\xe3o neurol\xf3gica. Tom assistivo, evitando linguagem prescritiva.",keywords:["neuro","neuro:","neurologia","neurol\xf3gico","neurologico","glasgow","gcs","pic","press\xe3o intracraniana","pressao intracraniana"]}},h=[],f="1.0.0",g="\n\n⚠️ **Lembrete importante**: Este \xe9 um prot\xf3tipo com dados completamente fict\xedcios e serve apenas como apoio \xe0 decis\xe3o, nunca substituindo a avalia\xe7\xe3o cl\xednica.";async function x(e){let a=Date.now();try{var i,o;let s,n;let t=await e.json(),u=(t.message||"").trim(),x=t.focusedPatientId??null,P=t.sessionId||`session-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,$=t.userId||"user-mock",v=t.role||"plantonista",I=t.unidade||"UTI Pedi\xe1trica A";t.turno;let b=p(P);x!==b.pacienteAtivo&&(p(P).pacienteAtivo=x);let w=t.currentAgent||"default",C=function(e,a){let i=e.toLowerCase();if(i.includes("cardio:")||i.includes("cardiologia:"))return"cardiology";if(i.includes("pneumo:")||i.includes("pneumologia:"))return"pneumology";if(i.includes("neuro:")||i.includes("neurologia:"))return"neurology";for(let[e,a]of Object.entries(m))if("default"!==e&&a.keywords.some(e=>i.includes(e)))return e;return a||"default"}(u,w),y=m[C];if(!u)return r.NextResponse.json({reply:"Por favor, envie uma mensagem."+g,showIcuPanel:!1});let S=function(e,a){let i=e.toLowerCase().trim();return i.includes("prioridade")||i.includes("priorizar")||i.includes("quem eu vejo primeiro")||i.includes("maior risco")||i.includes("pior paciente")||i.includes("mais grave")||i.includes("quem precisa")||i.includes("urgente")||i.includes("top")||i.includes("maior")&&i.includes("risco")||i.includes("pacientes mais cr\xedticos")||i.includes("quais pacientes")?"PRIORITIZACAO":a||i.match(/(?:UTI|leito)\s*\d+/i)||c.jf.some(e=>i.toLowerCase().includes(e.nome.toLowerCase()))||i.includes("resumo")&&(i.includes("paciente")||i.match(/(?:UTI|leito)/i))||i.includes("dados do paciente")||i.includes("informa\xe7\xf5es do paciente")||i.includes("esse paciente")||i.includes("este paciente")||i.includes("desse paciente")||i.includes("deste paciente")||i.includes("quadro")&&i.includes("paciente")||i.includes("situa\xe7\xe3o")&&i.includes("paciente")||i.includes("como est\xe1")&&i.includes("paciente")?"PACIENTE_ESPECIFICO":i.includes("sinais vitais")||i.includes("sinal vital")||i.includes("press\xe3o")||i.includes("temperatura")||i.includes("frequ\xeancia card\xedaca")||i.includes("frequ\xeancia respirat\xf3ria")||i.includes("satura\xe7\xe3o")||i.includes("pao2")||i.includes("pao2/fio2")||i.includes("hemodin\xe2mica")||i.includes("hemodinamica")?"SINAIS_VITAIS":i.includes("balan\xe7o h\xeddrico")||i.includes("balanco hidrico")||i.includes("balan\xe7o")||i.includes("balanco")||i.includes("diurese")||i.includes("diurese")||i.includes("entrada")||i.includes("sa\xedda")||i.includes("saida")||i.includes("l\xedquidos")||i.includes("liquidos")||i.includes("volume")||i.includes("hidrata\xe7\xe3o")||i.includes("hidratacao")?"BALANCO_HIDRICO":i.includes("perfil da unidade")||i.includes("perfil unidade")||i.includes("principais doen\xe7as")||i.includes("tipos de doen\xe7as")||i.includes("casu\xedstica")||i.includes("casuistica")||i.includes("epidemiologia")||i.includes("germes")||i.includes("resist\xeancia")||i.includes("resistencia")||i.includes("antibi\xf3ticos")||i.includes("antibioticos")||i.includes("\xfaltimos")&&(i.includes("meses")||i.includes("dias"))||i.includes("ultimos")&&(i.includes("meses")||i.includes("dias"))?"PERFIL_UNIDADE":i.includes("calcule")||i.includes("c\xe1lculo")||i.includes("calculo")||i.includes("dose")||i.includes("manuten\xe7\xe3o h\xeddrica")||i.includes("manutencao hidrica")||i.includes("fun\xe7\xe3o renal")||i.includes("funcao renal")||i.includes("clearance")||i.includes("schwartz")||i.includes("holliday")||i.includes("segar")||i.includes("quantos ml")||i.includes("quanto de")?"CALCULO_CLINICO":"FALLBACK"}(u,x);switch(S=function(e,a,i){let o=p(e);if(o.pacienteAtivo&&"FALLBACK"===a){let e=i.toLowerCase();if(e.includes("paciente")||e.includes("ele")||e.includes("ela")||e.includes("este"))return"PACIENTE_ESPECIFICO"}return o.ultimaInteracao&&o.ultimaInteracao.intencao,a}(P,S,u),function(e,a,i){let o=p(e),s={intencao:a,timestamp:new Date().toISOString(),pacienteId:i||o.pacienteAtivo||null};o.historicoIntencoes.push(s),o.ultimaInteracao=s,o.historicoIntencoes.length>10&&(o.historicoIntencoes=o.historicoIntencoes.slice(-10))}(P,S,x),S){case"PRIORITIZACAO":s={...function(e){let a=3,i=e.toLowerCase().match(/(\d+)/);if(i){let e=parseInt(i[1],10);!Number.isNaN(e)&&e>0&&e<=10&&(a=e)}let o=(0,c.AP)(a),s=[()=>`Ap\xf3s an\xe1lise dos prontu\xe1rios eletr\xf4nicos e c\xe1lculo de risco baseado em instabilidade hemodin\xe2mica, uso de vasopressores, ventila\xe7\xe3o mec\xe2nica, lactato elevado e tend\xeancias negativas, identifiquei os ${a} pacientes mais cr\xedticos. Veja os detalhes no painel abaixo.`,()=>`Com base na an\xe1lise de risco de mortalidade em 24h, instabilidade hemodin\xe2mica, uso de drogas vasoativas, ventila\xe7\xe3o mec\xe2nica e par\xe2metros laboratoriais cr\xedticos, selecionei os ${a} pacientes que requerem aten\xe7\xe3o imediata. Os detalhes est\xe3o no painel de prioriza\xe7\xe3o.`,()=>`Consulta aos prontu\xe1rios eletr\xf4nicos conclu\xedda. ${a} ${1===a?"paciente requer":"pacientes requerem"} aten\xe7\xe3o imediata baseado em crit\xe9rios de instabilidade, uso de suporte avan\xe7ado e par\xe2metros laboratoriais. Consulte o painel abaixo para detalhes completos.`];return{reply:(0,s[Math.floor(Math.random()*s.length)])()+g,topN:a,topPatients:o}}(u),showIcuPanel:!0};break;case"PACIENTE_ESPECIFICO":{let e=x;if(!e){let a=u.match(/(?:UTI|leito)\s*(\d+)/i);if(a){let i=a[1].padStart(2,"0"),o=`UTI ${i}`,s=c.jf.find(e=>e.leito===o);s&&(e=s.id)}if(!e){let a=c.jf.find(e=>u.toLowerCase().includes(e.nome.toLowerCase()));a&&(e=a.id)}}s=e?{...function(e){let a=c.jf.find(a=>a.id===e);if(!a)return{reply:"N\xe3o encontrei o paciente selecionado. Tente selecionar novamente."+g,showIcuPanel:!1};let i=(100*a.riscoMortality24h).toFixed(0),o=(100*a.riscoMortality7d).toFixed(0),s=(0,c.N8)(a.riscoMortality24h),n=[()=>`Resumo cl\xednico do paciente ${a.nome} (leito ${a.leito}): ${a.idade} ${1===a.idade?"ano":"anos"}, ${a.peso.toFixed(1)} kg, diagn\xf3stico principal ${a.diagnosticoPrincipal}. Risco estimado de mortalidade: ${i}% em 24h (${s}) e ${o}% em 7 dias. ${a.diasDeUTI} ${1===a.diasDeUTI?"dia":"dias"} de interna\xe7\xe3o na UTI. Consulte o painel abaixo para detalhes completos de sinais vitais, exames laboratoriais, medica\xe7\xf5es e par\xe2metros de ventila\xe7\xe3o.`,()=>{let e=a.medications.some(e=>"vasopressor"===e.tipo&&e.ativo),o=void 0!==a.ventilationParams;return`Paciente ${a.nome} (${a.leito}): ${a.idade} ${1===a.idade?"ano":"anos"}, ${a.diagnosticoPrincipal}. Risco de mortalidade em 24h: ${i}% (${s}). ${o?"Em ventila\xe7\xe3o mec\xe2nica.":""} ${e?"Em uso de droga vasoativa.":""} Veja o painel abaixo para informa\xe7\xf5es detalhadas sobre sinais vitais, balan\xe7o h\xeddrico, medica\xe7\xf5es e exames.`},()=>`An\xe1lise cl\xednica do paciente ${a.nome}, leito ${a.leito}: ${a.idade} ${1===a.idade?"ano":"anos"} de idade, ${a.peso.toFixed(1)} kg, com diagn\xf3stico de ${a.diagnosticoPrincipal}. Risco estimado de ${i}% em 24h. ${a.diasDeUTI} ${1===a.diasDeUTI?"dia":"dias"} de interna\xe7\xe3o. Os detalhes completos est\xe3o dispon\xedveis no painel individual abaixo.`];return{reply:(0,n[Math.floor(Math.random()*n.length)])()+g,showIcuPanel:!1,focusedPatient:a,selectedPatientId:a.id}}(e),showIcuPanel:!1}:{reply:"Para obter um resumo de um paciente espec\xedfico, mencione o leito (ex: 'UTI 03') ou o nome do paciente, ou selecione-o primeiro."+g,showIcuPanel:!1};break}case"SINAIS_VITAIS":s=function(){let e=[()=>{let e=[];e.push("Consultando sinais vitais de todos os pacientes no prontu\xe1rio eletr\xf4nico..."),e.push(""),e.push("**Resumo de sinais vitais cr\xedticos:**"),e.push("");let a=c.jf.filter(e=>e.vitalSigns.pressaoArterialMedia<65),i=c.jf.filter(e=>e.vitalSigns.frequenciaCardiaca>150),o=c.jf.filter(e=>e.vitalSigns.saturacaoO2<92),s=c.jf.filter(e=>e.vitalSigns.temperatura>=38.5);return e.push(`• **Hipotens\xe3o (MAP < 65 mmHg):** ${a.length} ${1===a.length?"paciente":"pacientes"}`),a.length>0&&a.forEach(a=>{e.push(`  - ${a.leito} (${a.nome}): MAP ${a.vitalSigns.pressaoArterialMedia} mmHg`)}),e.push(""),e.push(`• **Taquicardia (> 150 bpm):** ${i.length} ${1===i.length?"paciente":"pacientes"}`),e.push(`• **Hipoxemia (SpO2 < 92%):** ${o.length} ${1===o.length?"paciente":"pacientes"}`),e.push(`• **Febre (≥ 38.5\xb0C):** ${s.length} ${1===s.length?"paciente":"pacientes"}`),e.push(""),e.push("Dados obtidos do monitoramento cont\xednuo. Sempre confirme com a avalia\xe7\xe3o cl\xednica direta."),{text:e.join("\n"),showLab:!1}},()=>{let e=[];e.push("Analisando sinais vitais dos pacientes em tempo real..."),e.push("");let a=(0,c.AP)(3);return e.push("**Sinais vitais dos 3 pacientes mais cr\xedticos:**"),e.push(""),a.forEach((a,i)=>{e.push(`${i+1}. **${a.leito} — ${a.nome}**`),e.push(`   Temp: ${a.vitalSigns.temperatura.toFixed(1)}\xb0C | FC: ${a.vitalSigns.frequenciaCardiaca} bpm | FR: ${a.vitalSigns.frequenciaRespiratoria} rpm`),e.push(`   MAP: ${a.vitalSigns.pressaoArterialMedia} mmHg | SpO2: ${a.vitalSigns.saturacaoO2}%`),a.ventilationParams&&e.push(`   VM: ${a.ventilationParams.modo}, FiO2 ${a.ventilationParams.fiO2}%, PEEP ${a.ventilationParams.peep} cmH2O`),e.push("")}),{text:e.join("\n"),showLab:!0,topPatients:a}},()=>{let e=[];return e.push("Acessando dados de monitoramento hemodin\xe2mico e respirat\xf3rio..."),e.push(""),e.push("**Par\xe2metros hemodin\xe2micos e respirat\xf3rios:**"),e.push(""),c.jf.forEach(a=>{(a.medications.some(e=>"vasopressor"===e.tipo&&e.ativo)||a.vitalSigns.pressaoArterialMedia<65||a.ventilationParams)&&(e.push(`**${a.leito} — ${a.nome}:**`),e.push(`• MAP: ${a.vitalSigns.pressaoArterialMedia} mmHg | FC: ${a.vitalSigns.frequenciaCardiaca} bpm`),e.push(`• SpO2: ${a.vitalSigns.saturacaoO2}% | FR: ${a.vitalSigns.frequenciaRespiratoria} rpm`),a.ventilationParams&&e.push(`• VM: FiO2 ${a.ventilationParams.fiO2}%, PEEP ${a.ventilationParams.peep} cmH2O`),e.push(""))}),{text:e.join("\n"),showLab:!1}}],a=Math.floor(Math.random()*e.length),i=1===a?{text:e[1](),showLab:!0,topPatients:(0,c.AP)(3)}:{text:e[a](),showLab:!1};return{reply:i.text+g,showIcuPanel:!1,showLabPanel:i.showLab,topPatients:i.topPatients}}();break;case"BALANCO_HIDRICO":s=function(){let e=[()=>{let e=[];e.push("Consultando balan\xe7o h\xeddrico dos pacientes no prontu\xe1rio eletr\xf4nico..."),e.push(""),e.push("**Resumo de balan\xe7o h\xeddrico (\xfaltimas 24h):**"),e.push("");let a=c.jf.filter(e=>e.fluidBalance.balanco24h>3),i=c.jf.filter(e=>e.fluidBalance.balanco24h<-1),o=c.jf.filter(e=>e.fluidBalance.diurese<1);return e.push(`• **Balan\xe7o positivo excessivo (> 3 ml/kg/h):** ${a.length} ${1===a.length?"paciente":"pacientes"}`),a.length>0&&a.forEach(a=>{e.push(`  - ${a.leito} (${a.nome}): ${a.fluidBalance.balanco24h.toFixed(1)} ml/kg/h`)}),e.push(""),e.push(`• **Balan\xe7o negativo (< -1 ml/kg/h):** ${i.length} ${1===i.length?"paciente":"pacientes"}`),e.push(`• **Olig\xfaria (diurese < 1 ml/kg/h):** ${o.length} ${1===o.length?"paciente":"pacientes"}`),e.push(""),e.push("**Importante:** Em pediatria, o balan\xe7o h\xeddrico deve ser avaliado considerando peso, idade e estado cl\xednico. Valores em ml/kg/h facilitam a compara\xe7\xe3o entre pacientes de diferentes tamanhos."),e.join("\n")},()=>{let e=[];e.push("Analisando balan\xe7o h\xeddrico e diurese dos pacientes..."),e.push("");let a=(0,c.AP)(3);return e.push("**Balan\xe7o h\xeddrico dos 3 pacientes mais cr\xedticos:**"),e.push(""),a.forEach((a,i)=>{e.push(`${i+1}. **${a.leito} — ${a.nome}** (${a.peso.toFixed(1)} kg)`),e.push(`   Entrada 24h: ${a.fluidBalance.entrada24h.toFixed(1)} ml/kg/h (${a.fluidBalance.entradaTotal} ml total)`),e.push(`   Sa\xedda 24h: ${a.fluidBalance.saida24h.toFixed(1)} ml/kg/h (${a.fluidBalance.saidaTotal} ml total)`),e.push(`   Balan\xe7o: ${a.fluidBalance.balanco24h.toFixed(1)} ml/kg/h (${a.fluidBalance.balancoTotal>0?"+":""}${a.fluidBalance.balancoTotal} ml)`),e.push(`   Diurese: ${a.fluidBalance.diurese.toFixed(1)} ml/kg/h`),e.push("")}),e.join("\n")},()=>{let e=[];return e.push("Consultando registros de balan\xe7o h\xeddrico..."),e.push(""),e.push("**Balan\xe7o h\xeddrico detalhado:**"),e.push(""),c.jf.forEach(a=>{(a.fluidBalance.balanco24h>2||a.fluidBalance.diurese<1.5)&&(e.push(`**${a.leito} — ${a.nome}:**`),e.push(`• Entrada: ${a.fluidBalance.entrada24h.toFixed(1)} ml/kg/h | Sa\xedda: ${a.fluidBalance.saida24h.toFixed(1)} ml/kg/h`),e.push(`• Balan\xe7o: ${a.fluidBalance.balanco24h.toFixed(1)} ml/kg/h`),e.push(`• Diurese: ${a.fluidBalance.diurese.toFixed(1)} ml/kg/h`),a.fluidBalance.balanco24h>3&&e.push(`  ⚠️ Balan\xe7o positivo excessivo — considerar restri\xe7\xe3o h\xeddrica`),a.fluidBalance.diurese<1&&e.push(`  ⚠️ Olig\xfaria — avaliar fun\xe7\xe3o renal e estado vol\xeamico`),e.push(""))}),e.join("\n")}];return{reply:(0,e[Math.floor(Math.random()*e.length)])()+g,showIcuPanel:!1}}();break;case"PERFIL_UNIDADE":s=function(){let e=[()=>{let e=[];e.push("Analisando perfil epidemiol\xf3gico da UTI pedi\xe1trica (\xfaltimos 30 dias)..."),e.push(""),e.push("**Casu\xedstica da unidade:**"),e.push("");let a=c.KS.totalPacientes;return e.push(`• **Casos respirat\xf3rios (bronquiolite, pneumonia):** ${c.KS.casuistica.respiratorios}/${a} (${(c.KS.casuistica.respiratorios/a*100).toFixed(0)}%)`),e.push(`• **Sepse (diversos focos):** ${c.KS.casuistica.sepse}/${a} (${(c.KS.casuistica.sepse/a*100).toFixed(0)}%)`),e.push(`• **Cardiopatias cong\xeanitas:** ${c.KS.casuistica.cardiopatias}/${a} (${(c.KS.casuistica.cardiopatias/a*100).toFixed(0)}%)`),e.push(`• **Trauma:** ${c.KS.casuistica.trauma}/${a} (${(c.KS.casuistica.trauma/a*100).toFixed(0)}%)`),e.push(""),e.push("**Sazonalidade:** Observa-se maior incid\xeancia de casos respirat\xf3rios, compat\xedvel com sazonalidade de infec\xe7\xf5es virais na faixa et\xe1ria pedi\xe1trica."),e.push(""),e.push("**Germes mais frequentes:**"),c.KS.germesMaisFrequentes.forEach(a=>{e.push(`• ${a.nome}: ${a.frequencia} ${1===a.frequencia?"caso":"casos"}`),a.resistencia&&a.resistencia.length>0&&e.push(`  Resist\xeancia: ${a.resistencia.join(", ")}`)}),e.join("\n")},()=>{let e=[];return e.push("Gerando relat\xf3rio de perfil da unidade baseado em dados dos \xfaltimos 30 dias..."),e.push(""),e.push("**Distribui\xe7\xe3o por tipo de caso:**"),e.push(""),Object.entries(c.KS.casuistica).forEach(([a,i])=>{if(i>0){let o=a.charAt(0).toUpperCase()+a.slice(1);e.push(`• ${o}: ${i} ${1===i?"caso":"casos"}`)}}),e.push(""),e.push("**Perfil de resist\xeancia antimicrobiana:**"),e.push(""),c.KS.perfilResistencia.forEach(a=>{e.push(`• ${a.antibiotico}: ${(100*a.taxaResistencia).toFixed(0)}% de resist\xeancia`),e.push(`  Germes: ${a.germes.join(", ")}`)}),e.push(""),e.push("**Observa\xe7\xe3o:** Perfil t\xedpico de UTI pedi\xe1trica com predomin\xe2ncia de casos respirat\xf3rios e infecciosos, seguidos de cardiopatias e trauma."),e.join("\n")},()=>{let e=[];return e.push("Consultando banco de dados epidemiol\xf3gico da UTI pedi\xe1trica..."),e.push(""),e.push("**Perfil da casu\xedstica (\xfaltimos 30 dias):**"),e.push(""),e.push(`Total de pacientes: ${c.KS.totalPacientes}`),e.push(`Taxa de ocupa\xe7\xe3o: ${(100*c.KS.taxaOcupacao).toFixed(0)}%`),e.push(""),e.push("**Principais diagn\xf3sticos:**"),c.jf.forEach((a,i)=>{e.push(`${i+1}. ${a.diagnosticoPrincipal} — ${a.idade} ${1===a.idade?"ano":"anos"}`)}),e.push(""),e.push("**Padr\xe3o sazonal:** Maior concentra\xe7\xe3o de casos respirat\xf3rios e infecciosos, caracter\xedstico da faixa et\xe1ria pedi\xe1trica e sazonalidade de infec\xe7\xf5es virais."),e.join("\n")}];return{reply:(0,e[Math.floor(Math.random()*e.length)])()+g,showIcuPanel:!1,showUnitProfilePanel:!0}}();break;case"CALCULO_CLINICO":s=function(e,a){let i=e.toLowerCase(),o=a?c.jf.find(e=>e.id===a):null;if(i.includes("manuten\xe7\xe3o h\xeddrica")||i.includes("manutencao hidrica")||i.includes("holliday")||i.includes("segar")){if(!o)return{reply:"Para calcular a manuten\xe7\xe3o h\xeddrica, preciso do peso do paciente. Selecione um paciente ou informe o peso."+g,showIcuPanel:!1};try{let e=function(e){let a;if(e<=0)throw Error("Peso inv\xe1lido para c\xe1lculo de manuten\xe7\xe3o h\xeddrica");let i=(a=e<=10?100*e:e<=20?1e3+(e-10)*50:1500+(e-20)*20)/24;return{mlPerDay:Math.round(a),mlPerHour:Math.round(100*i)/100}}(o.peso),a=[];return a.push("**C\xe1lculo de manuten\xe7\xe3o h\xeddrica pedi\xe1trica (regra de Holliday-Segar):**"),a.push(""),a.push(`**Paciente:** ${o.nome} (${o.peso.toFixed(1)} kg)`),a.push(""),a.push("**F\xf3rmula:**"),a.push("- Primeiros 10 kg: 100 ml/kg/dia"),a.push("- 10-20 kg: 1000 ml + 50 ml/kg para cada kg acima de 10"),a.push("- > 20 kg: 1500 ml + 20 ml/kg para cada kg acima de 20"),a.push(""),a.push("**Resultado:**"),a.push(`• Manuten\xe7\xe3o h\xeddrica: **${e.mlPerDay} ml/dia**`),a.push(`• Infus\xe3o cont\xednua: **${e.mlPerHour} ml/hora**`),a.push(""),a.push("⚠️ **Importante:** Este \xe9 um exemplo de c\xe1lculo baseado em dados sint\xe9ticos. Sempre confirme dose e conduta em protocolo local e com a equipe m\xe9dica."),{reply:a.join("\n")+g,showIcuPanel:!1,calculationData:{type:"maintenance_fluids",...e}}}catch(e){return{reply:"Erro ao calcular manuten\xe7\xe3o h\xeddrica. Verifique se o peso do paciente est\xe1 dispon\xedvel."+g,showIcuPanel:!1}}}if(i.includes("fun\xe7\xe3o renal")||i.includes("funcao renal")||i.includes("clearance")||i.includes("schwartz")||i.includes("creatinina")){if(!o)return{reply:"Para calcular o clearance de creatinina (Schwartz), preciso de dados do paciente. Selecione um paciente."+g,showIcuPanel:!1};let e=o.labResults.find(e=>"funcao_renal"===e.tipo||e.nome.toLowerCase().includes("creatinina")),a=e&&"number"==typeof e.valor?e.valor:null;if(!a)return{reply:"N\xe3o encontrei creatinina s\xe9rica nos exames laboratoriais deste paciente. O c\xe1lculo de Schwartz requer creatinina s\xe9rica (mg/dL)."+g,showIcuPanel:!1};let i=o.idade<2?75+10*o.idade:75+6*o.idade,s=o.idade>=13?.7:.55;try{let e=function(e,a,i=.55){if(e<=0||a<=0||i<=0)throw Error("Valores inv\xe1lidos para c\xe1lculo de Schwartz");return{clCrMlMin1_73:Math.round(i*e/a*100)/100}}(i,a,s),n=[];return n.push("**C\xe1lculo de clearance de creatinina (f\xf3rmula de Schwartz):**"),n.push(""),n.push(`**Paciente:** ${o.nome} (${o.idade} ${1===o.idade?"ano":"anos"})`),n.push(`**Altura estimada:** ${i} cm`),n.push(`**Creatinina s\xe9rica:** ${a} mg/dL`),n.push(`**Constante K:** ${s} (${o.idade>=13?"adolescente":"crian\xe7a"})`),n.push(""),n.push("**F\xf3rmula:** ClCr = (K \xd7 altura em cm) / creatinina s\xe9rica"),n.push(""),n.push("**Resultado:**"),n.push(`• Clearance de creatinina: **${e.clCrMlMin1_73} ml/min/1.73m\xb2**`),n.push(""),n.push("⚠️ **Importante:** Este \xe9 um exemplo de c\xe1lculo baseado em dados sint\xe9ticos. A altura foi estimada. Sempre confirme com dados reais e protocolo local."),{reply:n.join("\n")+g,showIcuPanel:!1,calculationData:{type:"schwartz",...e}}}catch(e){return{reply:"Erro ao calcular clearance de creatinina."+g,showIcuPanel:!1}}}if(i.includes("dose")&&(i.includes("noradrenalina")||i.includes("dopamina")||i.includes("vasopressor")||i.includes("droga"))){if(!o)return{reply:"Para calcular a dose de droga, preciso do peso do paciente e da concentra\xe7\xe3o da solu\xe7\xe3o. Selecione um paciente."+g,showIcuPanel:!1};try{let e=function(e,a,i){if(e<=0)throw Error("Valores inv\xe1lidos para c\xe1lculo de dose");let o=.5*e;return{doseMcgMin:Math.round(100*o)/100,mlPerHour:Math.round(o/80*6e3)/100}}(o.peso,0,0),a=[];return a.push("**C\xe1lculo de dose de droga baseada em peso:**"),a.push(""),a.push(`**Paciente:** ${o.nome} (${o.peso.toFixed(1)} kg)`),a.push("**Dose prescrita:** 0.5 mcg/kg/min"),a.push(`**Concentra\xe7\xe3o da solu\xe7\xe3o:** 0.08 mg/ml`),a.push(""),a.push("**F\xf3rmula:**"),a.push("1. Dose total (mcg/min) = peso (kg) \xd7 dose (mcg/kg/min)"),a.push("2. Concentra\xe7\xe3o (mcg/ml) = concentra\xe7\xe3o (mg/ml) \xd7 1000"),a.push("3. Volume (ml/hora) = (dose total / concentra\xe7\xe3o) \xd7 60"),a.push(""),a.push("**Resultado:**"),a.push(`• Dose total: **${e.doseMcgMin} mcg/min**`),a.push(`• Infus\xe3o: **${e.mlPerHour} ml/hora**`),a.push(""),a.push("⚠️ **Importante:** Este \xe9 um exemplo de c\xe1lculo baseado em dados sint\xe9ticos. Sempre confirme dose e conduta em protocolo local e com a equipe m\xe9dica."),{reply:a.join("\n")+g,showIcuPanel:!1,calculationData:{type:"drug_dose",...e}}}catch(e){return{reply:"Erro ao calcular dose de droga."+g,showIcuPanel:!1}}}return{reply:"Posso ajudar com c\xe1lculos cl\xednicos pedi\xe1tricos:\n\n1. **Manuten\xe7\xe3o h\xeddrica** (regra de Holliday-Segar)\n2. **Clearance de creatinina** (f\xf3rmula de Schwartz)\n3. **C\xe1lculo de dose de droga** baseada em peso\n\nPara calcular, selecione um paciente e pergunte, por exemplo:\n• 'Calcule a manuten\xe7\xe3o h\xeddrica deste paciente'\n• 'Qual o clearance de creatinina?'\n• 'Calcule a dose de noradrenalina para este peso'"+g,showIcuPanel:!1}}(u,x);break;default:s={reply:"Ol\xe1! Sou o **Health Copilot +**, um assistente de apoio \xe0 decis\xe3o para UTI pedi\xe1trica.\n\nPosso ajudar com:\n\n1. **Prioriza\xe7\xe3o de pacientes** por risco de mortalidade e instabilidade\n2. **An\xe1lise de sinais vitais** e par\xe2metros hemodin\xe2micos\n3. **Balan\xe7o h\xeddrico** e diurese (ml/kg/h)\n4. **Perfil epidemiol\xf3gico da unidade** (casu\xedstica, germes, resist\xeancia)\n5. **Resumo completo de um paciente espec\xedfico**\n6. **C\xe1lculos cl\xednicos pedi\xe1tricos** (manuten\xe7\xe3o h\xeddrica, Schwartz, doses)\n\nTente perguntas como:\n• 'Quais s\xe3o os 3 pacientes com maior risco?'\n• 'Me mostre os sinais vitais cr\xedticos'\n• 'Qual o balan\xe7o h\xeddrico dos pacientes?'\n• 'Qual o perfil da unidade?'\n• 'Calcule a manuten\xe7\xe3o h\xeddrica deste paciente'\n• 'Resumo do paciente selecionado'"+g,showIcuPanel:!1}}let A=s.reply,E=!1;if(process.env.GROQ_API_KEY&&s.reply.length>100)try{A=await l({systemPrompt:y.systemPrompt,context:`Inten\xe7\xe3o detectada: ${S}. Dados do paciente: ${x?"Paciente focado":"Consulta geral"}. Agente: ${y.name}`,draftText:s.reply}),E=!0}catch(e){console.warn("LLM enhancement failed, using original text")}let M=`

---
**Health Copilot+ v${f}** | Dados: Simulados | ${E?"LLM: llama-3.1-70b-versatile":"Processamento determin\xedstico"}`;A+=M;let T="texto";s.showIcuPanel||s.showLabPanel||s.showUnitProfilePanel?T=s.calculationData?"misto":"painel":s.calculationData&&(T="calculo");let O=Date.now()-a;i={timestamp:new Date().toISOString(),sessionId:P,userId:$,role:v,unidade:I,pacienteFocado:x,intencaoDetectada:S,tipoResposta:T,versaoModelo:f,llmUtilizado:E,mensagemUsuario:u.substring(0,100),duracaoProcessamento:O},d.push(i);let k={tipo:s.calculationData?"calculo":s.showIcuPanel?"paciente":s.showLabPanel?"exames":s.showUnitProfilePanel?"perfil":"outro",ids:s.topPatients?.map(e=>e.id)||(s.focusedPatient?[s.focusedPatient.id]:void 0),quantidade:s.topPatients?.length||(s.focusedPatient?1:void 0)};return o={timestamp:new Date().toISOString(),sessionId:P,pergunta:(n=u.toLowerCase(),["sophia","gabriel","isabella","lucas","maria","jo\xe3o","ana","rafael","laura","enzo"].forEach(e=>{let a=RegExp(`\\b${e}\\b`,"gi");n=n.replace(a,"[nome]")}),n.substring(0,200)),intencao:S,dadosExibidos:k,duracaoProcessamento:O,llmUtilizado:E},h.push(o),r.NextResponse.json({reply:A,showIcuPanel:s.showIcuPanel,topN:s.topN,topPatients:s.topPatients,focusedPatient:s.focusedPatient,showLabPanel:s.showLabPanel,showUnitProfilePanel:s.showUnitProfilePanel,intent:S,agent:C,agentName:y.name})}catch(e){return r.NextResponse.json({reply:"Tive um problema tempor\xe1rio ao processar sua pergunta. Tente novamente em instantes."+g,showIcuPanel:!1},{status:500})}}let P=new s.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/chat/route",pathname:"/api/chat",filename:"route",bundlePath:"app/api/chat/route"},resolvedPagePath:"/Users/lucianoterres/Documents/GitHub/health-icu-copilot/app/api/chat/route.ts",nextConfigOutput:"",userland:o}),{requestAsyncStorage:$,staticGenerationAsyncStorage:v,serverHooks:I}=P,b="/api/chat/route";function w(){return(0,t.patchFetch)({serverHooks:I,staticGenerationAsyncStorage:v})}}};var a=require("../../../webpack-runtime.js");a.C(e);var i=e=>a(a.s=e),o=a.X(0,[948,972,666],()=>i(4215));module.exports=o})();